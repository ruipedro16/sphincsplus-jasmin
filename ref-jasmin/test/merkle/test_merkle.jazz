from Sphincs require "merkle/merkle.jtmpl"
from Sphincs require "generic/utils.jtmpl"

export fn merkle_gen_root_jazz(
  reg u64 _root _pub_seed _sk_seed
  )
{
  stack u8[SPX_N] root;
  reg ptr u8[SPX_N] root_p;

  stack ptr u8[SPX_N] pub_seed;
  reg ptr u8[SPX_N] pub_seed_p;

  stack ptr u8[SPX_N] sk_seed;
  reg ptr u8[SPX_N] sk_seed_p;

  stack u64 s_root s_pub_seed s_sk_seed;

  root_p = root;
  root_p = __load_u8_array<SPX_N>(root_p, _root);

  pub_seed_p = pub_seed;
  pub_seed_p = __load_u8_array<SPX_N>(pub_seed_p, _pub_seed);

  sk_seed_p = sk_seed; 
  sk_seed_p = __load_u8_array<SPX_N>(sk_seed_p, _sk_seed);

  s_root = _root; // spill

  root_p = __merkle_gen_root(root_p, pub_seed_p, sk_seed_p);

  _root = s_root; // unspill
  __store_u8_array<SPX_N>(root_p, _root);
}